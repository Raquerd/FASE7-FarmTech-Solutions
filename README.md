# Intelig√™ncia Artificial


## Instrutor
Lucas Gomes Moreira

## Integrantes do grupo
### GRUPO 29

Davi Santos Ferreira

Lais Kurahashi

Lucas Martinelli

# FASE 7 - FarmTech Solutions

## üìñ Descri√ß√£o do Projeto
Este projeto implementa um sistema completo para monitoramento de condi√ß√µes de plantio e automa√ß√£o de irriga√ß√£o em tempo real, utilizando um dispositivo ESP32, um Banco de Dados Oracle, uma API REST com Flask e um Modelo de Machine Learning (ML) para detec√ß√£o de anomalias nos dados dos sensores.

O sistema coleta dados de Umidade, Temperatura, pH e a presen√ßa simulada de F√≥sforo e Pot√°ssio, tomando decis√µes de irriga√ß√£o e enviando os dados para a nuvem.

## ‚öôÔ∏è Arquitetura do Sistema
O sistema √© dividido em tr√™s grandes m√≥dulos interconectados que utilizam tecnologias e m√©todos abordados durante todo o primeiro semestro do curso de Inteligencia Artificial da FIAP:

### Fase 1 - 3
Hardware (ESP32): Respons√°vel pela leitura dos sensores, aplica√ß√£o da l√≥gica de irriga√ß√£o e comunica√ß√£o com a API via Wi-Fi.

### Fase 4 - 6
Backend (API Flask/ML): Recebe os dados do ESP32, armazena no Oracle e utiliza um modelo de Isolation Forest para detectar anomalias, enviando alertas via AWS SNS se algo incomum for detectado.

### Fase 4 - 5
Frontend (Streamlit/CLI): Interfaces para gerenciamento manual e visualiza√ß√£o dos dados armazenados no banco.

| M√≥dulo                 | Arquivos                                  | Tecnologia Principal                             | Descri√ß√£o                                                                                                                          |
| :---                   | :---                                      | ---:                                             | ---:                                                                                                                               |
| Hardware/Firmware      | sistema_esp32.c, sistema_esp32.ino        | C/C++, ESP32, DHT22, LCD I2C, Rel√©               | L√≥gica de leitura de sensores e controle da bomba d'√°gua (rel√©). Envia dados via HTTP POST.                                        |
| Banco de Dados         | tbl_sensores.sql                          | Oracle Database                                  | Tabela principal TBL_SENSORES para armazenar todas as leituras de campo.                                                           |
| Modelo ML              | ml_anomalia.py, teste_ml_dados_falsos.py  | Python, Scikit-learn (Isolation Forest), Joblib  | Treina e testa o modelo de detec√ß√£o de anomalias (outliers) baseado em Umidade, Temperatura e pH.                                  |
| API Backend            | API_FLASK.py, alertas.py                  | Python, Flask, oracledb, AWS SNS                 | Interface REST que recebe os dados do ESP32, executa a previs√£o de anomalia e insere os dados no banco. Envia alertas via AWS SNS. |
| Gerenciamento de Dados | main.py, gerardados.py                    | Python, Streamlit, Pandas                        | main.py cria um painel de gerenciamento (CRUD) via Streamlit. gerardados.py simula e gera um grande volume de dados.               |

## üìù Configura√ß√£o do Ambiente

### 1. Backend e Machine Learning
__Pr√©-requisitos__
- Python 3.10 +
- PIP (Gerenciador de pacotes Python)

__Instala√ß√£o de Depend√™ncias__
```Bash

pip install pandas numpy scikit-learn joblib flask requests oracledb boto3 streamlit
```
#### Configura√ß√£o do Oracle Database
Execute o script tbl_sensores.sql no seu ambiente Oracle para criar a tabela de leituras:

```SQL

CREATE TABLE TBL_SENSORES (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    DATA_LEITURA TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UMIDADE NUMBER,
    TEMPERATURA NUMBER,
    PH NUMBER(4,2),
    FOSFORO NUMBER(1), -- 0 para Ausente, 1 para Presente
    POTASSIO NUMBER(1), -- 0 para Ausente, 1 para Presente
    BOMBA NUMBER(1), -- 0 para Desligada, 1 para Ligada
    PRIMARY KEY (ID)
);
```
#### Treinamento e Salvar do Modelo de Anomalia
Execute o script de treinamento para criar o arquivo .pkl do modelo de ML. Este modelo √© treinado em dados simulados de umidade, temperatura e pH.

```Bash
python ml_anomalia.py
```

### 2. AWS SNS e Alertas

__üöÄ Funcionalidade de Alertas__

O arquivo alertas.py √© respons√°vel por utilizar o AWS SNS para enviar notifica√ß√µes sempre que uma anomalia √© detectada pelo sistema.

__üîë Configura√ß√£o de Credenciais (IAM Role)__

As credenciais necess√°rias para acessar o AWS SNS foram configuradas atrav√©s de um IAM Role na Amazon.

Os dados de acesso (credentials) foram salvos em um arquivo .csv localizado na pasta config/ do projeto, seguindo as melhores pr√°ticas para a inicializa√ß√£o do acesso no script.

__üìß Detalhes da Implementa√ß√£o no alertas.py__
O sistema de alertas foi implementado usando o Amazon SNS com um t√≥pico do tipo Padr√£o (Standard).

Para fins de teste e prova de conceito, o ARN (Amazon Resource Name) do t√≥pico foi configurado para enviar alertas para um endere√ßo de e-mail de um dos membros da equipe


### 3. Firmware ESP32
Abra o arquivo sistema_esp32.c no Arduino IDE ou similar.

Configure suas credenciais de Wi-Fi nas constantes:
```C
const char* ssid = "NOME_DA_SUA_WIFI";
const char* password = "SENHA_DA_SUA_WIFI";
```
Ajuste o endere√ßo IP da API Flask no serverName. Se a API estiver rodando no seu PC, use o IP local:

```C
String serverName = "http://192.168.0.5:5000/api/dados"; // ALVO DA API FLASK
```

## ‚ñ∂Ô∏è Execu√ß√£o do Sistema
### 1. Iniciar a API Flask
Inicie o servi√ßo de backend que receber√° os dados e executar√° a detec√ß√£o de anomalias:

```Bash
python API_FLASK.py
```

### 2. Carregar o Firmware no ESP32
Compile e carregue o c√≥digo sistema_esp32.c no seu dispositivo ESP32. O ESP32 come√ßar√° a coletar dados, aplicar a l√≥gica de irriga√ß√£o e enviar requisi√ß√µes POST para a API a cada 10 minutos (conforme definido pelo delay(600000)).

### 3. Utilizar o Painel de Gerenciamento (Streamlit)
Para gerenciar (CRUD), visualizar e exportar os dados do Oracle, utilize a aplica√ß√£o Streamlit:

```Bash
streamlit run main.py
```

__Importante lembrar de que h√° um executavel que realiza a abertura do dash streamlit ja na pasta do projeto.__

A aplica√ß√£o abrir√° no seu navegador, fornecendo uma interface para Inserir, Consultar, Atualizar e Excluir dados da tabela TBL_SENSORES.

Funcionalidade Extra: Gera√ß√£o de Dados Simulado
Para popular o banco de dados com uma grande quantidade de registros de forma program√°tica, utilize o script de gera√ß√£o de dados.

```Bash
python gerardados.py]
# Este script salva um CSV, que pode ser importado via o painel Streamlit ou o script model.py
```

### 4. Sistema de Alertas
O sistema est√° implementado ao sistema da API FLASK conectado ao ESP32.
Esse sistema identifica se algum valor considerado como anomalia est√° presente nos dados gerados pelo ESP32, dessa forma, sinalizando por e-mail, caso algo esteja com valor incomum.

Esse valor vai ser determinado de acordo como o modelo IsolationForest utilizado para treinamento de identifica√ß√£o de anomalias presente no projeto.

O que pode ser considerado para o alerta ser gerado:

- __PH:__ Quando o PH bate menor do que 5.5 ou 7.5, o modelo identifica como anomalia. < PH muito alto ou muito acido

- __Umidade:__ Quando a Umidade esta acima de 90 ou abaixo de 20, √© identificado como Anomalia

- __Temperatura:__ Temperaturas muito altas ou muito baixas tamb√©m s√£o identificadas como anomalia.

## üí° L√≥gica de Irriga√ß√£o (Firmware)
A bomba d'√°gua (rel√©) √© ligada por 30 segundos se alguma das seguintes condi√ß√µes for verdadeira, indicando que a irriga√ß√£o ou a aplica√ß√£o de nutrientes √© necess√°ria:

__Umidade Baixa:__ Umidade do solo abaixo de 50%.

__F√≥sforo Ausente:__ O sensor de F√≥sforo (simulado pelo bot√£o) indica aus√™ncia.

__Pot√°ssio Ausente:__ O sensor de Pot√°ssio (simulado pelo bot√£o) indica aus√™ncia.

__pH Ruim:__ O pH est√° fora da faixa ideal de 5.5 a 7.5.

```C
// L√≥gica no arquivo sistema_esp32.c
bool umidadeBaixa = umidade < 50;
bool fosforoAusente = !fosforoPresente;
bool potassioAusente = !potassioPresente;
bool phRuim = (ph < 5.5 || ph > 7.5);

ligarBomba = (umidadeBaixa || fosforoAusente || potassioAusente || phRuim);
```
